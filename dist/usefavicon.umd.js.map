{"version":3,"file":"usefavicon.umd.js","sources":["../src/use-favicon.ts","../src/draw-functions.ts"],"sourcesContent":["import * as React from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\n\nconst createCanvas = (faviconSize: number) => {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = faviconSize;\n  canvas.height = faviconSize;\n\n  return canvas;\n};\n\nconst svgFaviconTemplate = (emoji: string) =>\n  `<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22>\n      <text y=%22.9em%22 font-size=%2290%22>\n        ${emoji}\n      </text>\n    </svg>\n  `.trim();\n\nfunction useFavicon() {\n  const [faviconHref, setFaviconHref] = React.useState<string>(null!);\n  const faviconTagRef = React.useRef<HTMLLinkElement>(null!);\n  const [originalHref, setOriginalHref] = React.useState<string>(null!);\n\n  // Grab initial favicon on mount\n  React.useEffect(() => {\n    // how do i know this is the right one for sure though?\n    const linkEl: HTMLLinkElement =\n      document.querySelector(\"link[rel~='icon']\") ||\n      document.head.appendChild(document.createElement(\"link\"));\n\n    faviconTagRef.current = linkEl;\n\n    setFaviconHref(faviconTagRef.current.href);\n    setOriginalHref(faviconTagRef.current.href);\n  }, []);\n\n  React.useEffect(() => {\n    faviconTagRef.current!.setAttribute(\"href\", faviconHref);\n  }, [faviconHref]);\n\n  const restoreFavicon = React.useCallback(() => {\n    setFaviconHref(originalHref);\n  }, [originalHref]);\n\n  const jsxToFavicon = React.useCallback((SvgEl: React.ReactSVGElement) => {\n    if (SvgEl.type !== \"svg\")\n      throw Error(\"React element for 'jsxToFavicon' must of type 'svg'\");\n\n    const renderedToString = renderToStaticMarkup(SvgEl);\n    const encoded = encodeURIComponent(renderedToString); \n    const replacedHashes = encoded.replace(/#/g, \"%23\");\n\n    setFaviconHref(`data:image/svg+xml,${replacedHashes}`);\n  }, []);\n\n  const setEmojiFavicon = React.useCallback((emoji) => {\n    setFaviconHref(`data:image/svg+xml,${svgFaviconTemplate(emoji)}`);\n  }, []);\n\n  const drawOnFavicon = React.useCallback(\n    (drawCallback, { faviconSize = 256, clear = false, ...props } = {}) => {\n      const canvas = createCanvas(faviconSize);\n\n      const img = document.createElement(\"img\");\n      img.setAttribute(\"src\", faviconHref);\n\n      // The load event fires when a given resource has loaded, so when the <img> src attribute has changed\n      img.onload = () => {\n        const context = canvas.getContext(\"2d\");\n\n        if (!context) {\n          console.warn(\"Could not create drawing context for favicon\");\n          return;\n        }\n\n        if (!clear)\n          context.drawImage(img, 0, 0, faviconSize, faviconSize); // Draw current favicon as background\n\n        drawCallback(context!, faviconSize, props);\n\n        const pngURI = canvas.toDataURL(\"image/png\");\n        setFaviconHref(pngURI);\n      };\n    },\n    [createCanvas, faviconHref]\n  );\n\n  return [\n    faviconHref,\n    {\n      jsxToFavicon,\n      restoreFavicon,\n      drawOnFavicon,\n      setFaviconHref,\n      setEmojiFavicon,\n    },\n  ];\n}\n\nexport { useFavicon };\nexport default useFavicon;\n","interface DrawCircleOptions {\n  fillColor: string;\n  radius: number;\n  x: number;\n  y: number;\n}\n\nexport const drawCircle = (\n  context: CanvasRenderingContext2D,\n  faviconSize: number,\n  options: DrawCircleOptions\n) => {\n  const {\n    fillColor = \"red\",\n    radius = faviconSize / 5,\n    x = faviconSize - faviconSize / 5,\n    y = faviconSize - faviconSize / 5,\n    \n  } = options;\n\n  context.beginPath();\n  context.arc(\n    x,\n    y,\n    radius,\n    0, // startAngle\n    2 * Math.PI // endAngle\n  );\n  context.fillStyle = fillColor;\n  context.fill();\n};\n\ninterface DrawSquareOptions {\n  fillColor: string;\n  length: number;\n  x: number;\n  y: number;\n}\n\nexport const drawSquare = (\n  context: CanvasRenderingContext2D,\n  faviconSize: number,\n  options: DrawSquareOptions\n) => {\n  const {\n    fillColor = \"black\",\n    length = faviconSize / 5,\n    x = faviconSize - faviconSize / 5,\n    y = faviconSize - faviconSize / 5,\n  } = options;\n\n  context.beginPath();\n  context.fillStyle = fillColor;\n  context.fillRect(\n    x,\n    y,\n    length, \n    length \n  );\n  context.fill();\n};\n\ninterface DrawTextBubbleOptions {\n  label: string;\n  color: string;\n  fontSize: number;\n  font: string;\n}\n\n// adapted from https://github.com/tommoor/tinycon/blob/master/tinycon.js#L167\nexport const drawTextBubble = (\n  context: CanvasRenderingContext2D,\n  faviconSize: number,\n  options: Partial<DrawTextBubbleOptions>\n) => {\n  const {\n    label = \"\",\n    color = \"orangered\",\n    fontSize = faviconSize / 2,\n    font = \"sans-serif\",\n  } = options;\n\n  // these numbers are pure trial and error I should have thought about them more it works ok though\n  // bubble needs to be wider for double digits, 4 digits max now\n  const extraWidth = (label.length * faviconSize) / 5;\n\n  const bubbleWidth = faviconSize / 3 + extraWidth;\n  const bubbleHeight = faviconSize / 1.5; // 2/3\n\n  const top = faviconSize - bubbleHeight,\n    left = faviconSize - bubbleWidth,\n    bottom = faviconSize,\n    right = faviconSize,\n    radius = faviconSize / 8,\n    textX =\n      label.length > 1\n        ? faviconSize - bubbleWidth / 4.75 + extraWidth / 4\n        : faviconSize - bubbleWidth / 4.75,\n    textY = faviconSize - bubbleHeight / 8;\n\n  context.fillStyle = color;\n  context.lineWidth = 12;\n\n  // bubble\n  context.beginPath();\n  context.moveTo(left + radius, top); //start\n  context.quadraticCurveTo(left, top, left, top + radius);\n  context.lineTo(left, bottom - radius);\n  context.quadraticCurveTo(left, bottom, left + radius, bottom);\n  context.lineTo(right - radius, bottom);\n  context.quadraticCurveTo(right, bottom, right, bottom - radius);\n  context.lineTo(right, top + radius);\n  context.quadraticCurveTo(right, top, right - radius, top);\n  context.closePath();\n  context.fill();\n\n  // bottom shadow\n  context.beginPath();\n  context.strokeStyle = \"rgba(0,0,0,0.3)\";\n  context.moveTo(left + radius / 2.0, bottom);\n  context.lineTo(right - radius / 2.0, bottom);\n  context.stroke();\n\n  // label\n  context.fillStyle = \"white\";\n  context.textAlign = \"right\";\n  context.textBaseline = \"bottom\";\n  context.lineWidth = faviconSize / 16;\n\n  context.fillStyle = \"white\";\n  context.font = `${fontSize}px ${font}`;\n\n  context.fillText(label, textX, textY);\n};\n\n"],"names":["createCanvas","faviconSize","canvas","document","createElement","width","height","svgFaviconTemplate","emoji","trim","useFavicon","React","useState","faviconHref","setFaviconHref","faviconTagRef","useRef","originalHref","setOriginalHref","useEffect","linkEl","querySelector","head","appendChild","current","href","setAttribute","restoreFavicon","useCallback","jsxToFavicon","SvgEl","type","Error","renderedToString","renderToStaticMarkup","encoded","encodeURIComponent","replacedHashes","replace","setEmojiFavicon","drawOnFavicon","drawCallback","clear","props","img","onload","context","getContext","console","warn","drawImage","pngURI","toDataURL","drawCircle","options","fillColor","radius","x","y","beginPath","arc","Math","PI","fillStyle","fill","drawSquare","length","fillRect","drawTextBubble","label","color","fontSize","font","extraWidth","bubbleWidth","bubbleHeight","top","left","bottom","right","textX","textY","lineWidth","moveTo","quadraticCurveTo","lineTo","closePath","strokeStyle","stroke","textAlign","textBaseline","fillText"],"mappings":"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"}